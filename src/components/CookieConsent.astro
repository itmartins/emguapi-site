---
// src/components/CookieConsent.astro
---
<div id="cookie-banner" class="fixed bottom-6 left-6 right-6 md:left-auto md:max-w-md bg-navy-dark text-white p-6 rounded-[2rem] shadow-2xl z-[100] border border-white/10 hidden transform translate-y-20 transition-transform duration-500">
  <div class="flex items-start gap-4">
    <div class="bg-red-base p-2 rounded-xl">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M12 2a10 10 0 1 0 10 10 4 4 0 0 1-5-5 4 4 0 0 1-5-5"></path>
        <path d="M8.5 8.5v.01"></path>
        <path d="M16 15.5v.01"></path>
        <path d="M12 12v.01"></path>
        <path d="M11 17v.01"></path>
        <path d="M7 14v.01"></path>
      </svg>
    </div>

    <div class="flex-1">
      <h4 class="font-black uppercase italic tracking-tighter text-sm mb-2">Valorizamos a sua privacidade</h4>
      <p class="text-[11px] leading-relaxed text-white/70 mb-4">
        Usamos cookies para melhorar a sua experiência, analisar o tráfego do portal e personalizar anúncios (o que ajuda a manter o <span class="text-white font-light">em</span>guapi<span class="text-red-base">.com</span> gratuito). 
        Ao clicar em "Aceitar Tudo", você concorda com nossos 
        <a href="/termos" class="text-white underline hover:text-red-base transition-colors">Termos de Uso</a> e 
        <a href="/privacidade" class="text-white underline hover:text-red-base transition-colors">Política de Privacidade</a>.
      </p>

      <div class="flex gap-3">
        <button id="accept-cookies" class="bg-white text-navy-dark px-6 py-2 rounded-full text-[10px] font-black uppercase tracking-widest hover:bg-red-base hover:text-white transition-colors">
          Aceitar Tudo
        </button>
        <button id="close-cookie" class="text-white/40 text-[10px] font-bold uppercase tracking-widest hover:text-white">
          Fechar
        </button>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  const banner = document.getElementById('cookie-banner');
  const acceptBtn = document.getElementById('accept-cookies');
  const closeBtn = document.getElementById('close-cookie');

  // Função para avisar o Google que o usuário deu o consentimento
  function updateGoogleConsent() {
    if (typeof gtag === 'function') {
      gtag('consent', 'update', {
        'ad_storage': 'granted',
        'ad_user_data': 'granted',
        'ad_personalization': 'granted',
        'analytics_storage': 'granted'
      });
      console.log('Consentimento GA4 atualizado.');
    }
  }

  // Verifica se o usuário já tomou uma decisão anteriormente
  if (!localStorage.getItem('cookies-accepted')) {
    setTimeout(() => {
        banner?.classList.remove('hidden');
        setTimeout(() => banner?.classList.remove('translate-y-20'), 100);
    }, 2000);
  } else {
    // Se já aceitou anteriormente, enviamos o sinal para o Google logo no carregamento
    updateGoogleConsent();
  }

  function hideBanner() {
    banner?.classList.add('translate-y-20');
    setTimeout(() => banner?.classList.add('hidden'), 500);
  }

  acceptBtn?.addEventListener('click', () => {
    localStorage.setItem('cookies-accepted', 'true');
    updateGoogleConsent(); // Ativa o rastreamento do Google
    hideBanner();
  });

  closeBtn?.addEventListener('click', () => {
    hideBanner();
  });
</script>